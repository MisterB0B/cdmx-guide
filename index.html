<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üá≤üáΩ CDMX Guide - Food, Music & Nightlife</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #0a0a0f;
            --surface: #12121a;
            --surface2: #1a1a25;
            --border: #2a2a3a;
            --purple: #a855f7;
            --teal: #06d6a0;
            --text: #f0f0f5;
            --text-dim: #8888a0;
            --red: #ef4444;
            --yellow: #fbbf24;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, rgba(168,85,247,0.1), rgba(6,214,160,0.1));
            border-bottom: 2px solid var(--border);
            padding: 2rem 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--purple), var(--teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: var(--text-dim);
            font-size: 0.95rem;
        }

        .translate-widget {
            margin-top: 0.75rem;
        }

        /* Filters */
        .filters {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            position: sticky;
            top: 120px;
            z-index: 99;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: transparent;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: var(--purple);
            color: var(--purple);
        }

        .filter-btn.active {
            background: var(--purple);
            border-color: var(--purple);
            color: var(--bg);
            font-weight: 600;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
            font-size: 0.9rem;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--purple);
        }

        /* Itinerary Section */
        .itinerary-section {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem 0;
        }

        .itinerary-title {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--purple), var(--teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .itinerary-toggle {
            text-align: center;
            margin-bottom: 1rem;
        }

        .itinerary-toggle button {
            padding: 0.6rem 1.5rem;
            border: 1px solid var(--purple);
            border-radius: 8px;
            background: rgba(168,85,247,0.1);
            color: var(--purple);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .itinerary-toggle button:hover {
            background: var(--purple);
            color: var(--bg);
        }

        .itinerary-days {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .day-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s;
        }

        .day-card:hover {
            border-color: var(--teal);
            box-shadow: 0 4px 20px rgba(6,214,160,0.15);
        }

        .day-number {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--teal);
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .day-card ul {
            list-style: none;
            padding: 0;
        }

        .day-card li {
            padding: 0.4rem 0;
            color: var(--text-dim);
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(42,42,58,0.5);
        }

        .day-card li:last-child {
            border-bottom: none;
        }

        .day-card li .time {
            color: var(--purple);
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .day-card li .cost {
            color: var(--teal);
            font-weight: 600;
            font-size: 0.85rem;
        }

        .day-total {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid var(--border);
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--yellow);
            text-align: right;
        }

        /* Spots Grid */
        .spots-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .category-section {
            margin-bottom: 3rem;
        }

        .category-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--purple);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
        }

        .spots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .spot-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .spot-card:hover {
            border-color: var(--purple);
            box-shadow: 0 4px 20px rgba(168,85,247,0.2);
            transform: translateY(-2px);
        }

        .spot-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--teal);
            margin-bottom: 0.5rem;
        }

        .spot-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            background: rgba(168,85,247,0.1);
            color: var(--purple);
            font-size: 0.8rem;
            margin-bottom: 0.75rem;
        }

        .spot-description {
            color: var(--text-dim);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .spot-details {
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .spot-detail {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: start;
            gap: 0.5rem;
        }

        .spot-detail .icon {
            min-width: 20px;
        }

        .spot-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: transparent;
            color: var(--purple);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: rgba(168,85,247,0.1);
            border-color: var(--purple);
        }

        .btn.teal {
            color: var(--teal);
            border-color: rgba(6,214,160,0.3);
        }

        .btn.teal:hover {
            background: rgba(6,214,160,0.1);
            border-color: var(--teal);
        }

        /* Rating */
        .spot-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .stars {
            color: var(--yellow);
        }

        .rating-count {
            color: var(--text-dim);
            font-size: 0.85rem;
        }

        /* Add Spot Button */
        .add-spot-fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--purple), var(--teal));
            color: white;
            font-size: 2rem;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(168,85,247,0.4);
            transition: all 0.3s;
            z-index: 1000;
        }

        .add-spot-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(168,85,247,0.6);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            overflow-y: auto;
            padding: 2rem 1rem;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--purple);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: var(--red);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text);
            font-weight: 600;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
            font-size: 0.95rem;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--purple);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .submit-btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--purple), var(--teal));
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(168,85,247,0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 4rem 1rem;
            color: var(--text-dim);
        }

        .loading-spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--purple);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 1rem;
            color: var(--text-dim);
        }

        .empty-state .emoji {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .spots-grid {
                grid-template-columns: 1fr;
            }

            .itinerary-days {
                grid-template-columns: 1fr;
            }

            .filters {
                top: 100px;
            }
        }

        /* Bob's Intel Badge */
        .bob-intel {
            background: linear-gradient(135deg, rgba(168,85,247,0.2), rgba(6,214,160,0.2));
            border: 1px solid var(--purple);
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .bob-intel strong {
            color: var(--teal);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üá≤üáΩ Mexico City Guide</h1>
        <p>Food, Music, Nightlife & Culture ‚Äî Curated by locals and travelers</p>
        <div class="translate-widget" id="google_translate_element"></div>
    </div>

    <div class="filters">
        <input type="text" class="search-box" id="searchInput" placeholder="üîç Search spots...">
        <button class="filter-btn active" data-category="all">All</button>
        <button class="filter-btn" data-category="mexican">üåÆ Mexican</button>
        <button class="filter-btn" data-category="japanese">üç± Japanese</button>
        <button class="filter-btn" data-category="korean">ü•ò Korean</button>
        <button class="filter-btn" data-category="nightlife">üç∫ Nightlife</button>
        <button class="filter-btn" data-category="tourist">üó∫Ô∏è Tourist</button>
        <button class="filter-btn" data-category="adult">üîû Adult 18+</button>
        <button class="filter-btn" data-category="breakfast">‚òï Breakfast</button>
        <button class="filter-btn" data-category="street">üö∂ Street Vendors</button>
    </div>

    <!-- Sample Itinerary -->
    <div class="itinerary-section" id="itinerarySection">
        <h2 class="itinerary-title">üóìÔ∏è Bob's Proven 5-Day CDMX Itinerary</h2>
        <div class="itinerary-toggle">
            <button onclick="document.getElementById('itineraryDays').style.display = document.getElementById('itineraryDays').style.display === 'none' ? 'grid' : 'none'">
                Show / Hide Itinerary
            </button>
        </div>
        <div class="itinerary-days" id="itineraryDays">
            <div class="day-card">
                <div class="day-number">üìÖ Day 1 ‚Äî Arrive & Explore Zona Rosa</div>
                <ul>
                    <li><span class="time">Morning:</span> Land at MEX, Uber to Sheraton Mar√≠a Isabel <span class="cost">~400 MXN</span></li>
                    <li><span class="time">Lunch:</span> Walk to WANWAN Sakaba or Taishu Teppan Sango <span class="cost">900 MXN</span></li>
                    <li><span class="time">Afternoon:</span> Walk Paseo de la Reforma ‚Üí Angel of Independence ‚Üí Zona Rosa. Free.</li>
                    <li><span class="time">Dinner:</span> Uber to M√°ximo Bistrot <span class="cost">120 MXN</span> + dinner <span class="cost">1,200 MXN</span></li>
                    <li><span class="time">Night:</span> Uber back to Cueva de Lobos <span class="cost">120 MXN</span> + drinks <span class="cost">200 MXN</span></li>
                </ul>
                <div class="day-total">üí∞ Total Day 1: ~2,940 MXN (~$170 USD)</div>
            </div>
            <div class="day-card">
                <div class="day-number">üìÖ Day 2 ‚Äî Teotihuacan + Centro Hist√≥rico</div>
                <ul>
                    <li><span class="time">Early AM:</span> Private tour guide to Teotihuacan <span class="cost">~1,200 MXN (transport + guide)</span></li>
                    <li><span class="time">Morning:</span> Pyramids entry <span class="cost">80 MXN</span></li>
                    <li><span class="time">Lunch:</span> La Gruta ‚Äî cave restaurant <span class="cost">450 MXN</span></li>
                    <li><span class="time">Afternoon:</span> Back to city, Uber to Centro <span class="cost">150 MXN</span>. Museums/sites <span class="cost">~150 MXN</span></li>
                    <li><span class="time">Dinner:</span> Limosneros <span class="cost">700 MXN</span></li>
                    <li><span class="time">Night:</span> Uber to Plaza Garibaldi <span class="cost">120 MXN</span> + mariachi <span class="cost">300 MXN</span> + drinks <span class="cost">150 MXN</span></li>
                </ul>
                <div class="day-total">üí∞ Total Day 2: ~3,300 MXN (~$190 USD)</div>
            </div>
            <div class="day-card">
                <div class="day-number">üìÖ Day 3 ‚Äî Markets + Xochimilco</div>
                <ul>
                    <li><span class="time">Morning:</span> Uber to Madre Caf√© <span class="cost">120 MXN</span> + breakfast <span class="cost">200 MXN</span></li>
                    <li><span class="time">Late Morning:</span> Uber to La Ciudadela Market <span class="cost">100 MXN</span> + souvenirs <span class="cost">~500 MXN</span></li>
                    <li><span class="time">Lunch:</span> Uber to La Merced Market <span class="cost">80 MXN</span> + food <span class="cost">150 MXN</span></li>
                    <li><span class="time">Afternoon:</span> Uber to Xochimilco <span class="cost">250 MXN</span> + trajinera boat <span class="cost">700 MXN</span></li>
                    <li><span class="time">Evening:</span> Uber to La Docena <span class="cost">200 MXN</span> + oysters/drinks <span class="cost">600 MXN</span></li>
                    <li><span class="time">Night:</span> Uber to Jazzatl√°n or Queen's <span class="cost">150 MXN</span> + cover/drinks <span class="cost">800 MXN</span></li>
                </ul>
                <div class="day-total">üí∞ Total Day 3: ~3,850 MXN (~$225 USD)</div>
            </div>
            <div class="day-card">
                <div class="day-number">üìÖ Day 4 ‚Äî Korean BBQ + Lucha Libre</div>
                <ul>
                    <li><span class="time">Morning:</span> Sleep in. Tamales from street vendor <span class="cost">30 MXN</span></li>
                    <li><span class="time">Lunch:</span> Uber to Kpop BBQ <span class="cost">120 MXN</span> + AYCE <span class="cost">400 MXN</span></li>
                    <li><span class="time">Afternoon:</span> Walk Roma/Condesa ‚Äî coffee <span class="cost">80 MXN</span></li>
                    <li><span class="time">Dinner:</span> El Califa tacos <span class="cost">200 MXN</span></li>
                    <li><span class="time">Night:</span> Uber to Arena M√©xico <span class="cost">150 MXN</span> + ringside tickets <span class="cost">350 MXN</span> + mask <span class="cost">150 MXN</span></li>
                </ul>
                <div class="day-total">üí∞ Total Day 4: ~1,480 MXN (~$85 USD)</div>
            </div>
            <div class="day-card">
                <div class="day-number">üìÖ Day 5 ‚Äî Last Day Favorites</div>
                <ul>
                    <li><span class="time">Morning:</span> Churros + coffee from street vendor <span class="cost">50 MXN</span></li>
                    <li><span class="time">Late Morning:</span> Farmacias Similares ‚Äî OTC meds <span class="cost">~200 MXN</span></li>
                    <li><span class="time">Lunch:</span> Uber to Rokai <span class="cost">120 MXN</span> + ramen <span class="cost">280 MXN</span></li>
                    <li><span class="time">Afternoon:</span> Last-minute shopping <span class="cost">~300 MXN</span></li>
                    <li><span class="time">Evening:</span> Uber to MEX Airport <span class="cost">400 MXN</span></li>
                </ul>
                <div class="day-total">üí∞ Total Day 5: ~1,350 MXN (~$80 USD)</div>
            </div>
        </div>
    </div>

    <div class="spots-container" id="spotsContainer">
        <div class="loading">
            <div class="loading-spinner"></div>
            <p>Loading spots...</p>
        </div>
    </div>

    <button class="add-spot-fab" id="addSpotBtn">+</button>

    <!-- Add Spot Modal -->
    <div class="modal" id="addSpotModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚ú® Add a Spot</h2>
                <button class="close-btn" id="closeModalBtn">√ó</button>
            </div>
            <form id="addSpotForm">
                <div class="form-group">
                    <label class="form-label">Name *</label>
                    <input type="text" class="form-input" id="spotName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Category *</label>
                    <select class="form-select" id="spotCategory" required>
                        <option value="mexican">Mexican</option>
                        <option value="japanese">Japanese</option>
                        <option value="korean">Korean</option>
                        <option value="nightlife">Nightlife</option>
                        <option value="tourist">Tourist</option>
                        <option value="adult">Adult 18+</option>
                        <option value="breakfast">Breakfast</option>
                        <option value="street">Street Vendor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="spotDescription"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Address</label>
                    <input type="text" class="form-input" id="spotAddress">
                </div>
                <div class="form-group">
                    <label class="form-label">Hours</label>
                    <input type="text" class="form-input" id="spotHours" placeholder="e.g., Mon-Fri 10am-10pm">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <input type="text" class="form-input" id="spotPhone">
                </div>
                <div class="form-group">
                    <label class="form-label">Price Range</label>
                    <input type="text" class="form-input" id="spotPrice" placeholder="e.g., 200-500 MXN">
                </div>
                <div class="form-group">
                    <label class="form-label">Your Take (Optional)</label>
                    <textarea class="form-textarea" id="spotIntel" placeholder="Local tips, what to try, best times to visit..."></textarea>
                </div>
                <button type="submit" class="submit-btn">Submit Spot</button>
            </form>
        </div>
    </div>

    <!-- Google Translate -->
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,es,ja,ko,fr,de,pt,zh-CN',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script>
        // Supabase Init
        const SUPABASE_URL = 'https://gwjtfcrgpxclixonogpe.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd3anRmY3JncHhjbGl4b25vZ3BlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMzQzOTUsImV4cCI6MjA4NTkxMDM5NX0.qM1-_VA1Dsx_nsWkeoAJvNWNgSuuwApPBGoJU32X3-I';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // All spots data (from spots-data.js)
        const initialSpots = [
            // ========== JAPANESE ==========
            {
                name: 'Taishu Teppan Sango',
                category: 'japanese',
                type: 'Teppanyaki',
                description: 'Okonomiyaki, teppanyaki, izakaya. Small spot, gets busy.',
                address: 'R√≠o P√°nuco 128, Col. Cuauht√©moc',
                distance: '10 min walk from Sheraton',
                hours: 'Tue-Sun 1pm-10pm, Closed Mon',
                phone: '',
                price: '~1,800 MXN for 2 people',
                google_maps: 'https://maps.google.com/?q=Taishu+Teppan+Sango+Mexico+City',
                bob_intel: 'Bob tried to go 2/14/26 but it was full. Backup = WANWAN Sakaba.'
            },
            {
                name: 'WANWAN Sakaba',
                category: 'japanese',
                type: 'Izakaya',
                description: 'Traditional izakaya with ramen and fried dishes.',
                address: 'Londres 209, Ju√°rez',
                distance: '8 min walk from Sheraton',
                hours: 'Mon-Sat 1pm-11pm, Sun 1pm-9pm',
                phone: '',
                price: '~1,800 MXN for 2 people',
                google_maps: 'https://maps.google.com/?q=WANWAN+Sakaba+Londres+209+Juarez+Mexico+City',
                bob_intel: 'Bob went here 2/14/26 when Sango was full. Had sushi + ramen, 1,795 MXN total. Good backup option.'
            },
            {
                name: 'Kura Izakaya',
                category: 'japanese',
                type: 'Izakaya',
                description: 'Japanese-run izakaya. Pork belly, premium sashimi, full menu.',
                address: 'Colima 378, Roma Norte',
                distance: '15 min walk from Sheraton',
                hours: 'Mon-Sat 1pm-11pm, Sun 1pm-6pm',
                phone: '',
                price: '400-600 MXN',
                google_maps: 'https://maps.google.com/?q=Kura+Izakaya+Colima+378+Roma+Norte+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'Rokai',
                category: 'japanese',
                type: 'Ramen',
                description: 'Top ramen spot. Tonkotsu, miso, shoyu. Gyoza, karaage.',
                address: 'Medell√≠n 101, Roma Norte',
                distance: '15 min walk from Sheraton',
                hours: 'Mon-Sat 1pm-10pm, Sun 1pm-9pm',
                phone: '',
                price: '200-350 MXN',
                google_maps: 'https://maps.google.com/?q=Rokai+Medellin+101+Roma+Norte+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'Kioko',
                category: 'japanese',
                type: 'Japanese',
                description: 'Upscale spot. Wagyu, sashimi, omakase. Great for date night.',
                address: 'Michoac√°n 25, Condesa',
                distance: '20 min walk from Sheraton',
                hours: 'Tue-Sat 2pm-11pm, Sun 2pm-10pm',
                phone: '',
                price: '800-1,200 MXN',
                google_maps: 'https://maps.google.com/?q=Kioko+Michoacan+25+Condesa+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'C.O.M.E',
                category: 'japanese',
                type: 'Yakitori',
                description: 'Budget yakitori, udon, mochi. Lunch specials ~90 MXN.',
                address: 'Coahuila 143, Roma Sur',
                distance: '15 min walk from Sheraton',
                hours: 'Mon-Sat 12pm-9pm, Closed Sun',
                phone: '',
                price: '90-200 MXN',
                google_maps: 'https://maps.google.com/?q=COME+Coahuila+143+Roma+Sur+Mexico+City',
                bob_intel: ''
            },
            // ========== KOREAN ==========
            {
                name: 'Kpop BBQ',
                category: 'korean',
                type: 'Korean BBQ',
                description: 'All-you-can-eat KBBQ. Beef, pork, chicken. Banchan, soju.',
                address: 'Insurgentes Sur 349, Hip√≥dromo',
                distance: '20 min walk / 8 min Uber',
                hours: 'Mon-Sun 1pm-11pm',
                phone: '+52 55 5264 8905',
                price: '350-450 MXN AYCE',
                google_maps: 'https://maps.google.com/?q=Kpop+BBQ+Insurgentes+Sur+349+Hipodromo+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'Seoul Town',
                category: 'korean',
                type: 'Korean BBQ',
                description: 'Authentic KBBQ, banchan station, private booths.',
                address: 'Dinamarca 106, Ju√°rez',
                distance: '15 min walk from Sheraton',
                hours: 'Mon-Sun 1pm-11pm',
                phone: '+52 55 5525 0022',
                price: '400-600 MXN',
                google_maps: 'https://maps.google.com/?q=Seoul+Town+Dinamarca+106+Juarez+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'Gogiyo',
                category: 'korean',
                type: 'Korean BBQ',
                description: 'Korean-run spot. Premium cuts, kimchi pancake, bibimbap.',
                address: 'Amsterdam 246, Hip√≥dromo Condesa',
                distance: '25 min walk / 10 min Uber',
                hours: 'Tue-Sun 2pm-11pm, Closed Mon',
                phone: '',
                price: '500-700 MXN',
                google_maps: 'https://maps.google.com/?q=Gogiyo+Amsterdam+246+Hipodromo+Condesa+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'Mukbang Korean Restaurant',
                category: 'korean',
                type: 'Korean',
                description: 'Full Korean menu. Bulgogi, jjigae, tteokbokki.',
                address: 'Tlaxcala 173, Hip√≥dromo',
                distance: '20 min walk / 8 min Uber',
                hours: 'Tue-Sun 1pm-10pm, Closed Mon',
                phone: '',
                price: '200-400 MXN',
                google_maps: 'https://maps.google.com/?q=Mukbang+Tlaxcala+173+Hipodromo+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'Hanu Korean Restaurant',
                category: 'korean',
                type: 'Korean',
                description: 'Casual Korean spot. Gimbap, ramyeon, fried chicken.',
                address: 'Jalapa 97, Roma Norte',
                distance: '18 min walk from Sheraton',
                hours: 'Wed-Mon 2pm-10pm, Closed Tue',
                phone: '',
                price: '150-300 MXN',
                google_maps: 'https://maps.google.com/?q=Hanu+Jalapa+97+Roma+Norte+Mexico+City',
                bob_intel: ''
            },
            // ========== NIGHTLIFE ==========
            {
                name: 'Cueva de Lobos',
                category: 'nightlife',
                type: 'Rock Bar',
                description: 'Rock bar with live bands, signature cocktails (Lobo Especial).',
                address: 'C. G√©nova 30, Ju√°rez',
                distance: '5 min walk from Sheraton',
                hours: 'Mon-Wed & Sun 10am-2am, Thu-Sat 8am-2am',
                phone: '+52 55 5507 2186',
                price: '150-250 MXN drinks',
                google_maps: 'https://maps.google.com/?q=Cueva+de+Lobos+Genova+30+Juarez+Mexico+City',
                bob_intel: 'Bob\'s #1 rock bar. End an epic day here OR go to Queen\'s. Your call.'
            },
            {
                name: 'Pulquer√≠a Los Insurgentes',
                category: 'nightlife',
                type: 'Pulquer√≠a',
                description: '4-story pulque bar with rooftop terrace, DJs, dance floor. Great for first-time pulque.',
                address: 'Av. Insurgentes Sur 226, Roma Norte',
                distance: '10 min Uber from Sheraton',
                hours: 'Fri 9am-11pm, Sat-Sun 9am-6pm (late nights vary)',
                phone: '+52 55 5207 0917',
                price: '60-120 MXN pulque',
                google_maps: 'https://maps.google.com/?q=Pulqueria+Los+Insurgentes+Mexico+City',
                bob_intel: 'Cool spot for first-time pulque. Poppin on weekends, chill on weekdays.'
            },
            {
                name: 'Jazzatl√°n Capital',
                category: 'nightlife',
                type: 'Jazz Bar',
                description: 'Live jazz and flamenco. Intimate, date-night vibe.',
                address: 'Zona Rosa',
                distance: '8 min walk from Sheraton',
                hours: 'Wed-Sat 8pm-2am',
                phone: '',
                price: '200-400 MXN',
                google_maps: 'https://maps.google.com/?q=Jazzatlan+Capital+Zona+Rosa+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'Multiforo Alicia',
                category: 'nightlife',
                type: 'Underground Venue',
                description: 'Underground punk, metal, indie shows. Dive bar aesthetic.',
                address: 'Cuauht√©moc 91-A, Centro',
                distance: '15 min Uber',
                hours: 'Event-based (Thu-Sat usually)',
                phone: '+52 55 5510 2164',
                price: '100-300 MXN cover',
                google_maps: 'https://maps.google.com/?q=Multiforo+Alicia+Centro+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'La Perla',
                category: 'nightlife',
                type: 'Dive Bar',
                description: 'Old-school cantina. Live mariachi, norte√±o, rock. Cash only.',
                address: 'Rep√∫blica de Cuba 44, Centro',
                distance: '15 min Uber',
                hours: 'Mon-Sat 1pm-1am, Closed Sun',
                phone: '',
                price: '80-150 MXN drinks',
                google_maps: 'https://maps.google.com/?q=La+Perla+Republica+de+Cuba+44+Centro+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'Vaquita Bar',
                category: 'nightlife',
                type: 'Dance Club',
                description: 'Party club. Open bar packages, DJ, dance floor.',
                address: 'Insurgentes Sur, Zona Rosa',
                distance: '10 min walk from Sheraton',
                hours: 'Thu-Sat 10pm-4am',
                phone: '',
                price: '400-600 MXN open bar',
                google_maps: 'https://maps.google.com/?q=Vaquita+Bar+Zona+Rosa+Mexico+City',
                bob_intel: ''
            },
            // ========== ADULT 18+ ==========
            {
                name: 'Queen\'s',
                category: 'adult',
                type: 'Strip Club',
                description: 'Upscale strip club. VIP sections, bottle service.',
                address: 'Hamburgo, Ju√°rez',
                distance: '12 min walk from Sheraton',
                hours: 'Mon-Sat 9pm-4am',
                phone: '',
                price: '500-1,500 MXN entry + drinks',
                google_maps: 'https://maps.google.com/?q=Queens+Hamburgo+Juarez+Mexico+City',
                bob_intel: 'Bob\'s pick for strip clubs. Can be the finale of an epic Teotihuacan ‚Üí Xochimilco ‚Üí Mariachi day.'
            },
            {
                name: 'Cabaret Show Girls',
                category: 'adult',
                type: 'Strip Club',
                description: 'Multi-level club, private rooms, full bar.',
                address: 'Londres, Ju√°rez',
                distance: '10 min walk from Sheraton',
                hours: 'Mon-Sat 8pm-4am',
                phone: '',
                price: '400-1,000 MXN',
                google_maps: 'https://maps.google.com/?q=Cabaret+Show+Girls+Londres+Juarez+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'Las Adelitas',
                category: 'adult',
                type: 'Strip Club',
                description: 'Mid-tier, more relaxed vibe than upscale spots.',
                address: 'Insurgentes Sur',
                distance: '15 min Uber',
                hours: 'Daily 6pm-3am',
                phone: '',
                price: '300-700 MXN',
                google_maps: 'https://maps.google.com/?q=Las+Adelitas+Insurgentes+Sur+Mexico+City',
                bob_intel: ''
            },
            {
                name: 'Bar Oriente',
                category: 'adult',
                type: 'Strip Club',
                description: 'Budget option. More dive bar than club.',
                address: 'Centro',
                distance: '15 min Uber',
                hours: 'Daily 4pm-2am',
                phone: '',
                price: '150-400 MXN',
                google_maps: '',
                bob_intel: 'Seedy tier. Not for everyone.'
            },
            {
                name: 'Parque M√©xico',
                category: 'adult',
                type: 'Weed Zone',
                description: 'Condesa park. Chill vibe, people smoke openly. Cops don\'t care.',
                address: 'Av. M√©xico, Condesa',
                distance: '20 min walk / 10 min Uber',
                hours: 'All day',
                phone: '',
                price: '',
                google_maps: 'https://maps.google.com/?q=Parque+Mexico+Condesa+Mexico+City',
                bob_intel: 'Most tolerant spot. Bring your own.'
            },
            {
                name: 'Zona Rosa',
                category: 'adult',
                type: 'Weed Zone',
                description: 'Gay district. Bars, clubs. People smoke on patios.',
                address: 'Zona Rosa',
                distance: '5 min walk from Sheraton',
                hours: '',
                phone: '',
                price: '',
                google_maps: '',
                bob_intel: 'Pretty chill. Stay on main streets at night.'
            },
            {
                name: 'Roma Norte Side Streets',
                category: 'adult',
                type: 'Weed Zone',
                description: 'Bohemian neighborhood. People smoke on bar patios, side streets.',
                address: 'Roma Norte',
                distance: '15 min walk / 10 min Uber',
                hours: '',
                phone: '',
                price: '',
                google_maps: '',
                bob_intel: 'Laid-back area. Just be discreet.'
            },
            // ========== BREAKFAST ==========
            {
                name: 'Madre Caf√©',
                category: 'breakfast',
                type: 'Breakfast/Brunch',
                description: 'Cozy breakfast spot, great coffee, pastries.',
                address: 'Roma Norte',
                distance: '',
                hours: 'Mon-Sun 8am-5pm',
                phone: '',
                price: '150-250 MXN',
                google_maps: '',
                bob_intel: 'Part of Bob\'s 5-day itinerary.'
            },
            // ========== MEXICAN ==========
            {
                name: 'M√°ximo Bistrot',
                category: 'mexican',
                type: 'Fine Dining',
                description: 'Upscale contemporary Mexican cuisine.',
                address: '√Ålvaro Obreg√≥n 65 Bis, Roma Norte',
                distance: '',
                hours: 'Mon-Sat 1pm-11pm, Closed Sun',
                phone: '',
                price: '800-1,500 MXN',
                google_maps: 'https://maps.google.com/?q=Maximo+Bistrot+Alvaro+Obregon+65+Bis+Roma+Norte+Mexico+City',
                bob_intel: 'Part of Bob\'s 5-day itinerary. High-end dinner spot.'
            },
            {
                name: 'La Docena',
                category: 'mexican',
                type: 'Oyster Bar',
                description: 'Fresh oysters, seafood cocktails, beachside vibe.',
                address: '√Ålvaro Obreg√≥n 31, Roma Norte',
                distance: '',
                hours: 'Daily 12pm-midnight',
                phone: '',
                price: '400-800 MXN',
                google_maps: 'https://maps.google.com/?q=La+Docena+Alvaro+Obregon+31+Roma+Norte+Mexico+City',
                bob_intel: 'Part of Bob\'s 5-day itinerary. Great for lunch/happy hour.'
            },
            {
                name: 'Limosneros',
                category: 'mexican',
                type: 'Contemporary Mexican',
                description: 'Creative Mexican dishes, historic Centro location.',
                address: 'Ignacio Allende 3, Centro Hist√≥rico',
                distance: '',
                hours: 'Tue-Sat 1pm-11pm, Sun 1pm-6pm',
                phone: '',
                price: '500-900 MXN',
                google_maps: 'https://maps.google.com/?q=Limosneros+Ignacio+Allende+3+Centro+Historico+Mexico+City',
                bob_intel: 'Part of Bob\'s 5-day itinerary.'
            },
            {
                name: 'La Gruta',
                category: 'mexican',
                type: 'Cave Restaurant',
                description: 'Cave restaurant near Teotihuacan pyramids. Traditional Mexican food.',
                address: 'Near Teotihuacan',
                distance: '1 hour from CDMX',
                hours: 'Daily 8am-7pm',
                phone: '',
                price: '300-600 MXN',
                google_maps: 'https://maps.google.com/?q=La+Gruta+Teotihuacan+Mexico',
                bob_intel: 'Part of Bob\'s 5-day itinerary. Stop here after visiting the pyramids.'
            },
            // ========== TOURIST ==========
            {
                name: 'La Ciudadela Market',
                category: 'tourist',
                type: 'Artisan Market',
                description: 'Massive artisan market. Textiles, pottery, leather, souvenirs.',
                address: 'Balderas, Centro',
                distance: '15 min Uber',
                hours: 'Daily 9am-7pm',
                phone: '',
                price: 'Varies (haggle)',
                google_maps: 'https://maps.google.com/?q=La+Ciudadela+Market+Mexico+City',
                bob_intel: 'Part of Bob\'s 5-day itinerary. Best market for souvenirs.'
            },
            {
                name: 'La Merced Market',
                category: 'tourist',
                type: 'Food Market',
                description: 'Enormous food market. Fresh produce, spices, street food.',
                address: 'Anillo de Circunvalaci√≥n, Centro',
                distance: '20 min Uber',
                hours: 'Daily 6am-6pm',
                phone: '',
                price: 'Budget-friendly',
                google_maps: 'https://maps.google.com/?q=La+Merced+Market+Mexico+City',
                bob_intel: 'Part of Bob\'s 5-day itinerary. Locals\' market, bring cash.'
            },
            {
                name: 'Arena M√©xico',
                category: 'tourist',
                type: 'Lucha Libre',
                description: 'Iconic wrestling arena. Friday night matches, masks, Dos Equis.',
                address: '189 Calle Dr. Lavista, Doctores',
                distance: '15 min Uber',
                hours: 'Shows Fridays 8:30pm',
                phone: '',
                price: '100-400 MXN tickets',
                google_maps: 'https://maps.google.com/?q=Arena+Mexico+189+Calle+Dr+Lavista+Doctores+Mexico+City',
                bob_intel: 'Part of Bob\'s 5-day itinerary. Get ringside seats, buy a mask.'
            },
            {
                name: 'Xochimilco Canals',
                category: 'tourist',
                type: 'Boat Ride',
                description: 'Colorful trajinera boats. Bring drinks, speaker, snacks. Mariachi boats (avoid or embrace).',
                address: 'Embarcadero Nativitas or Embarcadero Fernando Celada',
                distance: '1 hour from Centro',
                hours: 'Daily 9am-6pm',
                phone: '',
                price: '500-800 MXN per boat (holds 10-15 people)',
                google_maps: 'https://maps.google.com/?q=Xochimilco+Nativitas+Embarcadero+Mexico+City',
                bob_intel: 'Bring your own drinks/speaker. Phone flashlight in bottle = instant ambience. Mariachi boats will hound you ‚Äî negotiate or say no.'
            },
            {
                name: 'Teotihuacan Pyramids',
                category: 'tourist',
                type: 'Archaeological Site',
                description: 'Ancient pyramids. Climb Pyramid of the Sun. Get there early (opens 9am).',
                address: 'San Juan Teotihuac√°n, Estado de M√©xico',
                distance: '1 hour from Centro',
                hours: 'Daily 9am-5pm',
                phone: '',
                price: '80 MXN entry',
                google_maps: 'https://maps.google.com/?q=Teotihuacan+Pyramids+Mexico',
                bob_intel: 'Best option: ask Sheraton concierge for English-speaking private tour guide. Better than online tours. Go early, avoid noon heat. Lunch at La Gruta after.'
            },
            {
                name: 'Plaza Garibaldi',
                category: 'tourist',
                type: 'Mariachi Square',
                description: 'Mariachi central. Live music, tequila bars, pulquer√≠as. Gets rowdy at night.',
                address: 'Plaza Garibaldi, Centro',
                distance: '15 min Uber',
                hours: 'Best after 8pm',
                phone: '',
                price: '100-200 MXN per mariachi song',
                google_maps: 'https://maps.google.com/?q=Plaza+Garibaldi+Mexico+City',
                bob_intel: 'Can be the end of an epic day: Teotihuacan ‚Üí lunch ‚Üí Xochimilco ‚Üí mariachi square ‚Üí Queen\'s OR Cueva de Lobos. Bring cash, negotiate mariachi prices.'
            },
            {
                name: 'Farmacias Similares',
                category: 'tourist',
                type: 'Pharmacy',
                description: 'Budget pharmacy chain. OTC meds, some antibiotics/ED pills without prescription.',
                address: 'Everywhere (red/yellow signs)',
                distance: '',
                hours: 'Many 24hr',
                phone: '',
                price: 'Cheap',
                google_maps: '',
                bob_intel: 'Azithromycin, Ciprofloxacin available OTC. ED pills too. Still illegal to import to US.'
            },
            {
                name: 'Farmacias del Ahorro',
                category: 'tourist',
                type: 'Pharmacy',
                description: 'Another big chain. Similar selection to Similares.',
                address: 'Everywhere (green signs)',
                distance: '',
                hours: 'Many 24hr',
                phone: '',
                price: 'Cheap',
                google_maps: '',
                bob_intel: ''
            },
            // ========== STREET VENDORS ==========
            {
                name: 'Tacos Don G√ºero',
                category: 'street',
                type: 'Tacos',
                description: '24-hour taco stand. Al pastor, asada, suadero.',
                address: 'Various locations (mobile stands)',
                distance: '',
                hours: '24 hours',
                phone: '',
                price: '15-25 MXN per taco',
                google_maps: '',
                bob_intel: 'Street tacos = safe if cooked fresh + lots of customers. Avoid stands with no line.'
            },
            {
                name: 'El Califa',
                category: 'street',
                type: 'Tacos',
                description: 'Famous taco chain. Gaonera, costilla, campechano.',
                address: 'Multiple locations (Zona Rosa, Condesa)',
                distance: '',
                hours: 'Til 4:30am',
                phone: '',
                price: '40-60 MXN per taco',
                google_maps: 'https://maps.google.com/?q=El+Califa+Zona+Rosa+Mexico+City',
                bob_intel: 'Open late, touristy but solid quality.'
            },
            {
                name: 'Elotes & Esquites Vendors',
                category: 'street',
                type: 'Corn',
                description: 'Grilled corn (elotes) or corn in a cup (esquites). Mayo, cheese, chili, lime.',
                address: 'Everywhere (parks, plazas, street corners)',
                distance: '',
                hours: 'Afternoons/evenings',
                phone: '',
                price: '30-50 MXN',
                google_maps: '',
                bob_intel: 'Super safe. Cooked in front of you. Skip if corn looks old/dry.'
            },
            {
                name: 'Tamales Vendors',
                category: 'street',
                type: 'Tamales',
                description: 'Morning vendors with steaming carts. Rajas, mole, dulce.',
                address: 'Metro stations, plazas (mornings)',
                distance: '',
                hours: '6am-11am',
                phone: '',
                price: '15-30 MXN per tamale',
                google_maps: '',
                bob_intel: 'Breakfast staple. Safe if steaming hot.'
            },
            {
                name: 'Churros Vendors',
                category: 'street',
                type: 'Dessert',
                description: 'Fresh churros with chocolate or cajeta.',
                address: 'Parks, plazas, near churches',
                distance: '',
                hours: 'Afternoons/evenings',
                phone: '',
                price: '20-40 MXN',
                google_maps: '',
                bob_intel: 'Best after dinner. Crispy outside, soft inside.'
            }
        ];

        let allSpots = [];
        let currentFilter = 'all';

        // Load spots
        async function loadSpots() {
            try {
                const { data, error } = await supabase
                    .from('cdmx_spots')
                    .select('*')
                    .order('name');

                if (error) throw error;

                allSpots = data && data.length > 0 ? data : initialSpots;
                renderSpots();
            } catch (err) {
                console.error('Error loading spots:', err);
                allSpots = initialSpots;
                renderSpots();
            }
        }

        // Render spots
        function renderSpots() {
            const container = document.getElementById('spotsContainer');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            let filtered = allSpots;

            // Filter by category
            if (currentFilter !== 'all') {
                filtered = filtered.filter(s => s.category === currentFilter);
            }

            // Filter by search
            if (searchTerm) {
                filtered = filtered.filter(s => 
                    s.name.toLowerCase().includes(searchTerm) ||
                    (s.description && s.description.toLowerCase().includes(searchTerm)) ||
                    (s.type && s.type.toLowerCase().includes(searchTerm)) ||
                    (s.bob_intel && s.bob_intel.toLowerCase().includes(searchTerm))
                );
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">ü§∑</div>
                        <p>No spots found. Be the first to add one!</p>
                    </div>
                `;
                return;
            }

            // Group by category with display order
            const categoryOrder = ['mexican', 'japanese', 'korean', 'breakfast', 'street', 'nightlife', 'tourist', 'adult'];
            const grouped = {};
            filtered.forEach(spot => {
                if (!grouped[spot.category]) grouped[spot.category] = [];
                grouped[spot.category].push(spot);
            });

            const categoryNames = {
                mexican: 'Mexican',
                japanese: 'Japanese',
                korean: 'Korean',
                nightlife: 'Nightlife',
                tourist: 'Tourist & Useful',
                adult: 'Adult 18+',
                breakfast: 'Breakfast',
                street: 'Street Vendors'
            };

            let html = '';
            categoryOrder.forEach(cat => {
                if (!grouped[cat]) return;
                html += `
                    <div class="category-section">
                        <h2 class="category-title">${getCategoryEmoji(cat)} ${categoryNames[cat] || cat}</h2>
                        <div class="spots-grid">
                            ${grouped[cat].map(spot => renderSpotCard(spot)).join('')}
                        </div>
                    </div>
                `;
            });

            // Any categories not in the order
            Object.keys(grouped).forEach(cat => {
                if (!categoryOrder.includes(cat)) {
                    html += `
                        <div class="category-section">
                            <h2 class="category-title">${getCategoryEmoji(cat)} ${categoryNames[cat] || cat.charAt(0).toUpperCase() + cat.slice(1)}</h2>
                            <div class="spots-grid">
                                ${grouped[cat].map(spot => renderSpotCard(spot)).join('')}
                            </div>
                        </div>
                    `;
                }
            });

            container.innerHTML = html;
        }

        function renderSpotCard(spot) {
            return `
                <div class="spot-card">
                    <div class="spot-name">${spot.name}</div>
                    ${spot.type ? `<span class="spot-type">${spot.type}</span>` : ''}
                    ${spot.description ? `<div class="spot-description">${spot.description}</div>` : ''}
                    <div class="spot-details">
                        ${spot.address ? `<div class="spot-detail"><span class="icon">üìç</span>${spot.address}</div>` : ''}
                        ${spot.distance ? `<div class="spot-detail"><span class="icon">üö∂</span>${spot.distance}</div>` : ''}
                        ${spot.hours ? `<div class="spot-detail"><span class="icon">üïê</span>${spot.hours}</div>` : ''}
                        ${spot.phone ? `<div class="spot-detail"><span class="icon">üìû</span>${spot.phone}</div>` : ''}
                        ${spot.price ? `<div class="spot-detail"><span class="icon">üí∞</span>${spot.price}</div>` : ''}
                    </div>
                    ${spot.bob_intel ? `<div class="bob-intel"><strong>üß† Bob's Intel:</strong> ${spot.bob_intel}</div>` : ''}
                    <div class="spot-actions">
                        ${spot.google_maps ? `<a href="${spot.google_maps}" target="_blank" class="btn">üó∫Ô∏è Map</a>` : ''}
                        ${spot.phone ? `<a href="tel:${spot.phone}" class="btn teal">üìû Call</a>` : ''}
                    </div>
                </div>
            `;
        }

        function getCategoryEmoji(cat) {
            const emojis = {
                mexican: 'üåÆ',
                japanese: 'üç±',
                korean: 'ü•ò',
                chinese: 'ü•¢',
                nightlife: 'üç∫',
                tourist: 'üó∫Ô∏è',
                adult: 'üîû',
                breakfast: '‚òï',
                street: 'üö∂'
            };
            return emojis[cat] || 'üç¥';
        }

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.category;
                renderSpots();
            });
        });

        // Search
        document.getElementById('searchInput').addEventListener('input', renderSpots);

        // Modal
        document.getElementById('addSpotBtn').addEventListener('click', () => {
            document.getElementById('addSpotModal').classList.add('active');
        });

        document.getElementById('closeModalBtn').addEventListener('click', () => {
            document.getElementById('addSpotModal').classList.remove('active');
        });

        document.getElementById('addSpotModal').addEventListener('click', (e) => {
            if (e.target.id === 'addSpotModal') {
                document.getElementById('addSpotModal').classList.remove('active');
            }
        });

        // Form submit
        document.getElementById('addSpotForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const newSpot = {
                name: document.getElementById('spotName').value,
                category: document.getElementById('spotCategory').value,
                description: document.getElementById('spotDescription').value,
                address: document.getElementById('spotAddress').value,
                hours: document.getElementById('spotHours').value,
                phone: document.getElementById('spotPhone').value,
                price: document.getElementById('spotPrice').value,
                bob_intel: document.getElementById('spotIntel').value,
                created_at: new Date().toISOString()
            };

            try {
                const { data, error } = await supabase
                    .from('cdmx_spots')
                    .insert([newSpot])
                    .select();

                if (error) throw error;

                allSpots.push(data[0]);
                renderSpots();
                document.getElementById('addSpotModal').classList.remove('active');
                document.getElementById('addSpotForm').reset();
                alert('‚úÖ Spot added! Thanks for contributing!');
            } catch (err) {
                console.error('Error adding spot:', err);
                alert('‚ùå Error adding spot. Please try again.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Spot';
            }
        });

        // Init
        loadSpots();
    </script>
</body>
</html>
